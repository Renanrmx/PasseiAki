var ChaCha20Poly1305=(()=>{var Q=Object.defineProperty;var it=Object.getOwnPropertyDescriptor;var nt=Object.getOwnPropertyNames;var ht=Object.prototype.hasOwnProperty;var ft=(s,t)=>{for(var e in t)Q(s,e,{get:t[e],enumerable:!0})},st=(s,t,e,h)=>{if(t&&typeof t=="object"||typeof t=="function")for(let f of nt(t))!ht.call(s,f)&&f!==e&&Q(s,f,{get:()=>t[f],enumerable:!(h=it(t,f))||h.enumerable});return s};var lt=s=>st(Q({},"__esModule",{value:!0}),s);var ct={};ft(ct,{ChaCha20Poly1305:()=>m,KEY_LENGTH:()=>tt,NONCE_LENGTH:()=>et,TAG_LENGTH:()=>rt});var at=Number.isInteger,bt=Number.MAX_SAFE_INTEGER,ot=Number.isSafeInteger;function A(s,t=new Uint8Array(4),e=0){return t[e+0]=s>>>0,t[e+1]=s>>>8,t[e+2]=s>>>16,t[e+3]=s>>>24,t}function W(s,t=new Uint8Array(8),e=0){return A(s>>>0,t,e),A(s/4294967296>>>0,t,e+4),t}function X(s){for(let t=0;t<s.length;t++)s[t]=0;return s}var _t=20;function xt(s,t,e){let h=1634760805,f=857760878,i=2036477234,l=1797285236,r=e[3]<<24|e[2]<<16|e[1]<<8|e[0],o=e[7]<<24|e[6]<<16|e[5]<<8|e[4],u=e[11]<<24|e[10]<<16|e[9]<<8|e[8],B=e[15]<<24|e[14]<<16|e[13]<<8|e[12],C=e[19]<<24|e[18]<<16|e[17]<<8|e[16],F=e[23]<<24|e[22]<<16|e[21]<<8|e[20],I=e[27]<<24|e[26]<<16|e[25]<<8|e[24],j=e[31]<<24|e[30]<<16|e[29]<<8|e[28],K=t[3]<<24|t[2]<<16|t[1]<<8|t[0],M=t[7]<<24|t[6]<<16|t[5]<<8|t[4],z=t[11]<<24|t[10]<<16|t[9]<<8|t[8],Y=t[15]<<24|t[14]<<16|t[13]<<8|t[12],g=h,c=f,E=i,a=l,x=r,w=o,b=u,U=B,O=C,N=F,v=I,T=j,d=K,p=M,n=z,_=Y;for(let L=0;L<_t;L+=2)g=g+x|0,d^=g,d=d>>>16|d<<16,O=O+d|0,x^=O,x=x>>>20|x<<12,c=c+w|0,p^=c,p=p>>>16|p<<16,N=N+p|0,w^=N,w=w>>>20|w<<12,E=E+b|0,n^=E,n=n>>>16|n<<16,v=v+n|0,b^=v,b=b>>>20|b<<12,a=a+U|0,_^=a,_=_>>>16|_<<16,T=T+_|0,U^=T,U=U>>>20|U<<12,E=E+b|0,n^=E,n=n>>>24|n<<8,v=v+n|0,b^=v,b=b>>>25|b<<7,a=a+U|0,_^=a,_=_>>>24|_<<8,T=T+_|0,U^=T,U=U>>>25|U<<7,c=c+w|0,p^=c,p=p>>>24|p<<8,N=N+p|0,w^=N,w=w>>>25|w<<7,g=g+x|0,d^=g,d=d>>>24|d<<8,O=O+d|0,x^=O,x=x>>>25|x<<7,g=g+w|0,_^=g,_=_>>>16|_<<16,v=v+_|0,w^=v,w=w>>>20|w<<12,c=c+b|0,d^=c,d=d>>>16|d<<16,T=T+d|0,b^=T,b=b>>>20|b<<12,E=E+U|0,p^=E,p=p>>>16|p<<16,O=O+p|0,U^=O,U=U>>>20|U<<12,a=a+x|0,n^=a,n=n>>>16|n<<16,N=N+n|0,x^=N,x=x>>>20|x<<12,E=E+U|0,p^=E,p=p>>>24|p<<8,O=O+p|0,U^=O,U=U>>>25|U<<7,a=a+x|0,n^=a,n=n>>>24|n<<8,N=N+n|0,x^=N,x=x>>>25|x<<7,c=c+b|0,d^=c,d=d>>>24|d<<8,T=T+d|0,b^=T,b=b>>>25|b<<7,g=g+w|0,_^=g,_=_>>>24|_<<8,v=v+_|0,w^=v,w=w>>>25|w<<7;A(g+h|0,s,0),A(c+f|0,s,4),A(E+i|0,s,8),A(a+l|0,s,12),A(x+r|0,s,16),A(w+o|0,s,20),A(b+u|0,s,24),A(U+B|0,s,28),A(O+C|0,s,32),A(N+F|0,s,36),A(v+I|0,s,40),A(T+j|0,s,44),A(d+K|0,s,48),A(p+M|0,s,52),A(n+z|0,s,56),A(_+Y|0,s,60)}function Z(s,t,e,h,f=0){if(s.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(h.length<e.length)throw new Error("ChaCha: destination is shorter than source");let i,l;if(f===0){if(t.length!==8&&t.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");i=new Uint8Array(16),l=i.length-t.length,i.set(t,l)}else{if(t.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");i=t,l=f}let r=new Uint8Array(64);for(let o=0;o<e.length;o+=64){xt(r,i,s);for(let u=o;u<o+64&&u<e.length;u++)h[u]=e[u]^r[u-o];wt(i,0,l)}return X(r),f===0&&X(i),h}function $(s,t,e,h=0){return X(e),Z(s,t,e,e,h)}function wt(s,t,e){let h=1;for(;e--;)h=h+(s[t]&255)|0,s[t]=h&255,h>>>=8,t++;if(h>0)throw new Error("ChaCha: counter overflow")}function ut(s,t){if(s.length!==t.length)return 0;let e=0;for(let h=0;h<s.length;h++)e|=s[h]^t[h];return 1&e-1>>>8}function y(s,t){return s.length===0||t.length===0?!1:ut(s,t)!==0}var gt=16,J=class{digestLength=gt;_buffer=new Uint8Array(16);_r=new Uint16Array(10);_h=new Uint16Array(10);_pad=new Uint16Array(8);_leftover=0;_fin=0;_finished=!1;constructor(t){let e=t[0]|t[1]<<8;this._r[0]=e&8191;let h=t[2]|t[3]<<8;this._r[1]=(e>>>13|h<<3)&8191;let f=t[4]|t[5]<<8;this._r[2]=(h>>>10|f<<6)&7939;let i=t[6]|t[7]<<8;this._r[3]=(f>>>7|i<<9)&8191;let l=t[8]|t[9]<<8;this._r[4]=(i>>>4|l<<12)&255,this._r[5]=l>>>1&8190;let r=t[10]|t[11]<<8;this._r[6]=(l>>>14|r<<2)&8191;let o=t[12]|t[13]<<8;this._r[7]=(r>>>11|o<<5)&8065;let u=t[14]|t[15]<<8;this._r[8]=(o>>>8|u<<8)&8191,this._r[9]=u>>>5&127,this._pad[0]=t[16]|t[17]<<8,this._pad[1]=t[18]|t[19]<<8,this._pad[2]=t[20]|t[21]<<8,this._pad[3]=t[22]|t[23]<<8,this._pad[4]=t[24]|t[25]<<8,this._pad[5]=t[26]|t[27]<<8,this._pad[6]=t[28]|t[29]<<8,this._pad[7]=t[30]|t[31]<<8}_blocks(t,e,h){let f=this._fin?0:2048,i=this._h[0],l=this._h[1],r=this._h[2],o=this._h[3],u=this._h[4],B=this._h[5],C=this._h[6],F=this._h[7],I=this._h[8],j=this._h[9],K=this._r[0],M=this._r[1],z=this._r[2],Y=this._r[3],g=this._r[4],c=this._r[5],E=this._r[6],a=this._r[7],x=this._r[8],w=this._r[9];for(;h>=16;){let b=t[e+0]|t[e+1]<<8;i+=b&8191;let U=t[e+2]|t[e+3]<<8;l+=(b>>>13|U<<3)&8191;let O=t[e+4]|t[e+5]<<8;r+=(U>>>10|O<<6)&8191;let N=t[e+6]|t[e+7]<<8;o+=(O>>>7|N<<9)&8191;let v=t[e+8]|t[e+9]<<8;u+=(N>>>4|v<<12)&8191,B+=v>>>1&8191;let T=t[e+10]|t[e+11]<<8;C+=(v>>>14|T<<2)&8191;let d=t[e+12]|t[e+13]<<8;F+=(T>>>11|d<<5)&8191;let p=t[e+14]|t[e+15]<<8;I+=(d>>>8|p<<8)&8191,j+=p>>>5|f;let n=0,_=n;_+=i*K,_+=l*(5*w),_+=r*(5*x),_+=o*(5*a),_+=u*(5*E),n=_>>>13,_&=8191,_+=B*(5*c),_+=C*(5*g),_+=F*(5*Y),_+=I*(5*z),_+=j*(5*M),n+=_>>>13,_&=8191;let L=n;L+=i*M,L+=l*K,L+=r*(5*w),L+=o*(5*x),L+=u*(5*a),n=L>>>13,L&=8191,L+=B*(5*E),L+=C*(5*c),L+=F*(5*g),L+=I*(5*Y),L+=j*(5*z),n+=L>>>13,L&=8191;let G=n;G+=i*z,G+=l*M,G+=r*K,G+=o*(5*w),G+=u*(5*x),n=G>>>13,G&=8191,G+=B*(5*a),G+=C*(5*E),G+=F*(5*c),G+=I*(5*g),G+=j*(5*Y),n+=G>>>13,G&=8191;let S=n;S+=i*Y,S+=l*z,S+=r*M,S+=o*K,S+=u*(5*w),n=S>>>13,S&=8191,S+=B*(5*x),S+=C*(5*a),S+=F*(5*E),S+=I*(5*c),S+=j*(5*g),n+=S>>>13,S&=8191;let V=n;V+=i*g,V+=l*Y,V+=r*z,V+=o*M,V+=u*K,n=V>>>13,V&=8191,V+=B*(5*w),V+=C*(5*x),V+=F*(5*a),V+=I*(5*E),V+=j*(5*c),n+=V>>>13,V&=8191;let q=n;q+=i*c,q+=l*g,q+=r*Y,q+=o*z,q+=u*M,n=q>>>13,q&=8191,q+=B*K,q+=C*(5*w),q+=F*(5*x),q+=I*(5*a),q+=j*(5*E),n+=q>>>13,q&=8191;let D=n;D+=i*E,D+=l*c,D+=r*g,D+=o*Y,D+=u*z,n=D>>>13,D&=8191,D+=B*M,D+=C*K,D+=F*(5*w),D+=I*(5*x),D+=j*(5*a),n+=D>>>13,D&=8191;let R=n;R+=i*a,R+=l*E,R+=r*c,R+=o*g,R+=u*Y,n=R>>>13,R&=8191,R+=B*z,R+=C*M,R+=F*K,R+=I*(5*w),R+=j*(5*x),n+=R>>>13,R&=8191;let P=n;P+=i*x,P+=l*a,P+=r*E,P+=o*c,P+=u*g,n=P>>>13,P&=8191,P+=B*Y,P+=C*z,P+=F*M,P+=I*K,P+=j*(5*w),n+=P>>>13,P&=8191;let H=n;H+=i*w,H+=l*x,H+=r*a,H+=o*E,H+=u*c,n=H>>>13,H&=8191,H+=B*g,H+=C*Y,H+=F*z,H+=I*M,H+=j*K,n+=H>>>13,H&=8191,n=(n<<2)+n|0,n=n+_|0,_=n&8191,n=n>>>13,L+=n,i=_,l=L,r=G,o=S,u=V,B=q,C=D,F=R,I=P,j=H,e+=16,h-=16}this._h[0]=i,this._h[1]=l,this._h[2]=r,this._h[3]=o,this._h[4]=u,this._h[5]=B,this._h[6]=C,this._h[7]=F,this._h[8]=I,this._h[9]=j}finish(t,e=0){let h=new Uint16Array(10),f,i,l,r;if(this._leftover){for(r=this._leftover,this._buffer[r++]=1;r<16;r++)this._buffer[r]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(f=this._h[1]>>>13,this._h[1]&=8191,r=2;r<10;r++)this._h[r]+=f,f=this._h[r]>>>13,this._h[r]&=8191;for(this._h[0]+=f*5,f=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=f,f=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=f,h[0]=this._h[0]+5,f=h[0]>>>13,h[0]&=8191,r=1;r<10;r++)h[r]=this._h[r]+f,f=h[r]>>>13,h[r]&=8191;for(h[9]-=8192,i=(f^1)-1,r=0;r<10;r++)h[r]&=i;for(i=~i,r=0;r<10;r++)this._h[r]=this._h[r]&i|h[r];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,l=this._h[0]+this._pad[0],this._h[0]=l&65535,r=1;r<8;r++)l=(this._h[r]+this._pad[r]|0)+(l>>>16)|0,this._h[r]=l&65535;return t[e+0]=this._h[0]>>>0,t[e+1]=this._h[0]>>>8,t[e+2]=this._h[1]>>>0,t[e+3]=this._h[1]>>>8,t[e+4]=this._h[2]>>>0,t[e+5]=this._h[2]>>>8,t[e+6]=this._h[3]>>>0,t[e+7]=this._h[3]>>>8,t[e+8]=this._h[4]>>>0,t[e+9]=this._h[4]>>>8,t[e+10]=this._h[5]>>>0,t[e+11]=this._h[5]>>>8,t[e+12]=this._h[6]>>>0,t[e+13]=this._h[6]>>>8,t[e+14]=this._h[7]>>>0,t[e+15]=this._h[7]>>>8,this._finished=!0,this}update(t){let e=0,h=t.length,f;if(this._leftover){f=16-this._leftover,f>h&&(f=h);for(let i=0;i<f;i++)this._buffer[this._leftover+i]=t[e+i];if(h-=f,e+=f,this._leftover+=f,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(h>=16&&(f=h-h%16,this._blocks(t,e,f),e+=f,h-=f),h){for(let i=0;i<h;i++)this._buffer[this._leftover+i]=t[e+i];this._leftover+=h}return this}digest(){if(this._finished)throw new Error("Poly1305 was finished");let t=new Uint8Array(16);return this.finish(t),t}clean(){return X(this._buffer),X(this._r),X(this._h),X(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this}};var tt=32,et=12,rt=16,k=new Uint8Array(16),m=class{nonceLength=et;tagLength=rt;_key;constructor(t){if(t.length!==tt)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(t)}seal(t,e,h,f){if(t.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");let i=new Uint8Array(16);i.set(t,i.length-t.length);let l=new Uint8Array(32);$(this._key,i,l,4);let r=e.length+this.tagLength,o;if(f){if(f.length!==r)throw new Error("ChaCha20Poly1305: incorrect destination length");o=f}else o=new Uint8Array(r);return Z(this._key,i,e,o,4),this._authenticate(o.subarray(o.length-this.tagLength,o.length),l,o.subarray(0,o.length-this.tagLength),h),X(i),o}open(t,e,h,f){if(t.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(e.length<this.tagLength)return null;let i=new Uint8Array(16);i.set(t,i.length-t.length);let l=new Uint8Array(32);$(this._key,i,l,4);let r=new Uint8Array(this.tagLength);if(this._authenticate(r,l,e.subarray(0,e.length-this.tagLength),h),!y(r,e.subarray(e.length-this.tagLength,e.length)))return null;let o=e.length-this.tagLength,u;if(f){if(f.length!==o)throw new Error("ChaCha20Poly1305: incorrect destination length");u=f}else u=new Uint8Array(o);return Z(this._key,i,e.subarray(0,e.length-this.tagLength),u,4),X(i),u}clean(){return X(this._key),this}_authenticate(t,e,h,f){let i=new J(e);f&&(i.update(f),f.length%16>0&&i.update(k.subarray(f.length%16))),i.update(h),h.length%16>0&&i.update(k.subarray(h.length%16));let l=new Uint8Array(8);f&&W(f.length,l),i.update(l),W(h.length,l),i.update(l);let r=i.digest();for(let o=0;o<r.length;o++)t[o]=r[o];i.clean(),X(r),X(l)}};return lt(ct);})();
